<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bitcoin Stale Block Dataset</title>
  <meta name="description" content="A dataset of $total stale block headers and full blocks observed on the Bitcoin network.">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
  <script>function toggle(id){document.getElementById(id).classList.toggle("hidden")}</script>
</head>
<body class="bg-gray-950 text-gray-300 min-h-screen">
  <div class="max-w-7xl mx-auto px-4 py-12">

    <header class="mb-10">
      <h1 class="text-3xl font-bold text-white mb-2">Bitcoin Stale Block Dataset</h1>
      <p class="text-gray-400">Stale block headers and full blocks observed on the Bitcoin network.</p>
    </header>

    <section class="mb-8">
      <p class="mb-4">
        Stale blocks occur when two miners find a valid block at the same height.
        Only one can become part of the longest chain &mdash; the other becomes "stale."
      </p>
      <p>
        Contribute your own stale block data using
        <a href="$repo_url/blob/master/get-data.py" class="text-blue-400 hover:text-blue-300 underline">get-data.py</a>
        with a Bitcoin Core node. See the
        <a href="$repo_url" class="text-blue-400 hover:text-blue-300 underline">repository</a>
        for details.
      </p>
    </section>

    <section class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-10">
      <div class="bg-gray-900 rounded-lg p-5 border border-gray-800">
        <div class="text-gray-400 text-sm mb-1">stale blocks</div>
        <div class="text-2xl font-bold text-white">$total</div>
      </div>
      <div class="bg-gray-900 rounded-lg p-5 border border-gray-800">
        <div class="text-gray-400 text-sm mb-1">with header</div>
        <div class="text-2xl font-bold text-white">$with_header</div>
      </div>
      <div class="bg-gray-900 rounded-lg p-5 border border-gray-800">
        <div class="text-gray-400 text-sm mb-1">with full block</div>
        <div class="text-2xl font-bold text-white">$with_block</div>
      </div>
    </section>

    <section class="mb-10">
      <h2 class="text-xl font-bold text-white mb-4">Stale Block Rate</h2>
      <div class="bg-gray-900 rounded-lg p-5 border border-gray-800">
        <canvas id="rate-chart" height="120"></canvas>
      </div>
      <p class="text-gray-500 text-sm mt-2">Stale blocks per 1'000 blocks (~1 week), 10'000 block rolling average.</p>
      <p class="text-gray-500 text-sm mt-2">
          Annotations show:
          <ul class="text-gray-500">
            <li>- around block 390000: Launch of the <a href="https://bitcoinrelaynetwork.org/">Bitcoin Relay Network</a></li>
            <li>- around block 430000: Compact block relay (BIP-152) support is <a href="https://bitcoincore.org/en/releases/0.13.0/#compact-block-support-bip-152">released</a> in Bitcoin Core v0.13</li>
            <li>- around block 490000: The FIBRE network is <a href="https://bitcoinfibre.org/">announced</a></li>
            <li>- around block 789000: A <a href="https://bitcoincore.org/en/2024/10/08/disclose-large-inv-to-send/">bug</a> affects block relay and causes 10 stale blocks in one week</li>
            <li>- around block 919000: <a href="https://github.com/bitcoin/bitcoin/pull/33106">sub 1 sat/vbyte summer</a></li>
          </ul>
      </p>
    </section>
    <script>
      (function() {
        var d = $chart_data;
        var points = d.labels.map(function(l, i) { return {x: l, y: d.data[i]}; });
        new Chart(document.getElementById("rate-chart"), {
          type: "line",
          data: {
            datasets: [{
              data: points,
              borderColor: "#60a5fa",
              borderWidth: 1.5,
              pointRadius: 0,
              fill: false,
              tension: 0.3
            }]
          },
          options: {
            plugins: {
              legend: { display: false },
              annotation: {
                annotations: [
                  { type: "line", xMin: 390000, xMax: 390000, borderColor: "#f59e0b88", borderWidth: 1, borderDash: [4, 4], label: { display: true, content: "Bitcoin Relay Network", color: "#f59e0b", backgroundColor: "transparent", font: { size: 11 }, position: "end", rotation: -90, yAdjust: -10 } },
                  { type: "line", xMin: 430000, xMax: 430000, borderColor: "#a78bfa88", borderWidth: 1, borderDash: [4, 4], label: { display: true, content: "compact block relay", color: "#a78bfa", backgroundColor: "transparent", font: { size: 11 }, position: "end", rotation: -90, yAdjust: -10 } },
                  { type: "line", xMin: 490000, xMax: 490000, borderColor: "#34d39988", borderWidth: 1, borderDash: [4, 4], label: { display: true, content: "FIBRE", color: "#34d399", backgroundColor: "transparent", font: { size: 11 }, position: "end", rotation: -90, yAdjust: -10 } },
                  { type: "line", xMin: 789000, xMax: 789000, borderColor: "#f59e0b88", borderWidth: 1, borderDash: [4, 4], label: { display: true, content: "inv-to-send bug", color: "#f59e0b", backgroundColor: "transparent", font: { size: 11 }, position: "end", rotation: -90, yAdjust: -10 } },
                  { type: "line", xMin: 919000, xMax: 919000, borderColor: "#f472b688", borderWidth: 1, borderDash: [4, 4], label: { display: true, content: "sub 1 sat/vbyte summer", color: "#f472b6", backgroundColor: "transparent", font: { size: 11 }, position: "end", rotation: -90, yAdjust: -10 } }
                ]
              }
            },
            scales: {
              x: {
                type: "linear",
                title: { display: true, text: "block height", color: "#9ca3af" },
                ticks: { color: "#6b7280", maxTicksLimit: 12 },
                grid: { color: "#1f2937" }
              },
              y: {
                title: { display: true, text: "Stale rate per 1000 blocks", color: "#9ca3af" },
                ticks: { color: "#6b7280" },
                grid: { color: "#1f2937" },
                beginAtZero: true
              }
            },
            interaction: { intersect: false, mode: "index" }
          }
        });
      })();
    </script>

    <section>
      <div class="overflow-x-auto">
        <table class="w-full text-left text-sm">
          <thead>
            <tr class="border-b border-gray-700 text-gray-400">
              <th class="py-2 px-3 font-medium w-28">height</th>
              <th class="py-2 px-3 font-medium">hash</th>
              <th class="py-2 px-3 font-medium text-center w-28">header</th>
              <th class="py-2 px-3 font-medium text-center w-28">block</th>
            </tr>
          </thead>
          <tbody>
$table_rows
          </tbody>
        </table>
      </div>
    </section>

  </div>
</body>
</html>
